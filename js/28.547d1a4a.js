"use strict";(self["webpackChunkshoppinglistmanager"]=self["webpackChunkshoppinglistmanager"]||[]).push([[28],{6113:function(e,t,s){s.d(t,{Z:function(){return l}});var r=s(2482),a=(s(6699),s(9520));class n extends a.ZP{constructor(){super("Article"),(0,r.Z)(this,"articles",void 0),this.version(1).stores({articles:"++id,*triples"})}}class i{constructor(){(0,r.Z)(this,"db",new n)}async getArticles(){return this.db.articles.toArray()}async getLocalArticleCount(){return this.db.articles.count()}async searchArticlesByName(e){return this.db.articles.filter((t=>t.name.toLowerCase().includes(e.toLowerCase()))).toArray()}async searchArticlesByDescription(e){return this.db.articles.filter((t=>t.description.toLowerCase().includes(e.toLowerCase()))).toArray()}async searchArticles(e){if(0===e.trim().length)return this.db.articles.toArray();const t=e.toLowerCase();return this.db.articles.filter((e=>this.matches(e,t))).toArray()}async searchArticlesWithQuery(e){if(e.trim().length<3)return this.db.articles.toArray();const t=e.substring(0,3).toLowerCase(),s=e.toLowerCase();return this.db.articles.where("triples").equals(t).filter((e=>this.matches(e,s))).toArray()}matches(e,t){return!t||e.name.toLowerCase().includes(t)||e.description.toLowerCase().includes(t)}async store(e){return console.log("ArticleDBService.store store "+e.length+" articles"),this.db.articles.bulkPut(e).then((()=>e.length))}async clear(){this.db.articles.clear()}}var l=new i},2028:function(e,t,s){s.r(t),s.d(t,{default:function(){return v}});var r=s(6252),a=s(3577),n=s(9963);const i=(0,r.Uk)("Search Articles"),l=["src"];function c(e,t,s,c,o,u){const d=(0,r.up)("v-card-title"),h=(0,r.up)("v-text-field"),m=(0,r.up)("v-btn"),g=(0,r.up)("v-card-text"),p=(0,r.up)("v-card"),w=(0,r.up)("v-list-item-title"),f=(0,r.up)("v-list-item-subtitle"),y=(0,r.up)("v-list-item-header"),v=(0,r.up)("v-list-item"),b=(0,r.up)("InfiniteScroll"),A=(0,r.up)("v-container");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)(p,null,{default:(0,r.w5)((()=>[(0,r.Wm)(d,null,{default:(0,r.w5)((()=>[(0,r.Uk)("Article Search ("+(0,a.zw)(e.state.articlesCount)+")",1)])),_:1}),(0,r.Wm)(g,{class:"d-flex align-center"},{default:(0,r.w5)((()=>[(0,r.Wm)(h,{modelValue:e.state.searchTerm,"onUpdate:modelValue":t[0]||(t[0]=t=>e.state.searchTerm=t),"hide-details":"auto",label:"Enter a search term",style:{color:"white"},onKeyup:(0,n.D2)(e.searchArticles,["enter"])},null,8,["modelValue","onKeyup"]),(0,r.Wm)(m,{class:"flex-grow-0 ml-4",onClick:e.searchArticles},{default:(0,r.w5)((()=>[i])),_:1},8,["onClick"])])),_:1})])),_:1}),((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.state.messages,((e,t)=>((0,r.wg)(),(0,r.iD)("p",{key:t},(0,a.zw)(e),1)))),128)),(0,r.Wm)(A,null,{default:(0,r.w5)((()=>[(0,r.Uk)(" Found Articles ("+(0,a.zw)(e.state.articles.length)+") ",1),(0,r.Wm)(b,(0,r.dG)(e.state.pagination,{onLoadMoreItems:e.loadItems}),{default:(0,r.w5)((({item:e})=>[(0,r.Wm)(v,{lines:"three"},{default:(0,r.w5)((()=>[(0,r.Wm)(y,null,{default:(0,r.w5)((()=>[(0,r.Wm)(w,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,a.zw)(e.id)+" - "+(0,a.zw)(e.name),1)])),_:2},1024),(0,r.Wm)(f,null,{default:(0,r.w5)((()=>[(0,r.Uk)((0,a.zw)(e.description),1)])),_:2},1024),(0,r.Wm)(f,null,{default:(0,r.w5)((()=>[""!==e.base64Image?((0,r.wg)(),(0,r.iD)("img",{key:0,src:`data:image/png;base64,${e.base64Image}`,style:{width:"30%"}},null,8,l)):(0,r.kq)("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1},16,["onLoadMoreItems"])])),_:1})],64)}var o=s(2262),u=s(6113),d=s(5293);function h(e,t,s,a,n,i){const l=(0,r.Q2)("intersect");return(0,r.wg)(),(0,r.iD)(r.HY,null,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.items,((t,s)=>((0,r.wg)(),(0,r.iD)("div",{key:s},[(0,r.WI)(e.$slots,"default",{item:t})])))),128)),(0,r.wy)((0,r._)("div",null,null,512),[[l,e.onIntersect]])],64)}var m=(0,r.aZ)({name:"InfiniteScroll",props:{items:Array,lastPage:Number,page:Number},setup(e,{emit:t}){(0,r.bv)((()=>{t("loadMoreItems",1)}));const s=(s,r)=>{const a=void 0!==e.page?e.page:1,n=void 0!==e.lastPage?e.lastPage:0;r[0].isIntersecting&&a<n&&t("loadMoreItems",a+1)};return{onIntersect:s}}}),g=s(3744);const p=(0,g.Z)(m,[["render",h]]);var w=p,f=(0,r.aZ)({name:"SearchView",components:{InfiniteScroll:w},setup(){const e=(0,o.qj)({articles:new Array,articlesCount:0,searchTerm:"",isOnline:!1,pagination:{page:0,items:[],lastPage:0},messages:[]});(0,r.bv)((()=>{t(),d.Z.registerOnlineStatusUpdateListener(t),u.Z.getLocalArticleCount().then((t=>{e.articlesCount=t})).catch((e=>{console.log(e)}))}));const t=()=>{e.isOnline=d.Z.isOnline},s=()=>{const t=performance.now();u.Z.searchArticlesWithQuery(e.searchTerm).then((s=>{const r=performance.now();e.articles=s,e.messages.push(`Searching for "${e.searchTerm}" took ${Math.ceil(r-t)/1e3} s and delivered ${s.length} out of ${e.articlesCount}`),a(1)})).catch((s=>{console.log(s);const r=performance.now();e.messages.push(`Exception after ${Math.ceil(r-t)/1e3} s while searching ${e.searchTerm} - ${s}`)}))},a=t=>{const s=10;e.pagination.lastPage=Math.ceil(e.articles.length/s),e.pagination.page=t,e.pagination.items=e.articles.slice(0,t*s)};return{state:e,updateOnlineStatus:t,searchArticles:s,loadItems:a}}});const y=(0,g.Z)(f,[["render",c]]);var v=y}}]);
//# sourceMappingURL=28.547d1a4a.js.map